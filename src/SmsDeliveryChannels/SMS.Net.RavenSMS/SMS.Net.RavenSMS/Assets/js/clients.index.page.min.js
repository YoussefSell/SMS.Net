"function"!=typeof Object.create&&(Object.create=function(t){function o(){}return o.prototype=t,new o}),function(t,o,i,s){"use strict";var n={_positionClasses:["bottom-left","bottom-right","top-right","top-left","bottom-center","top-center","mid-center"],_defaultIcons:["success","error","info","warning"],init:function(o,i){this.prepareOptions(o,t.toast.options),this.process()},prepareOptions:function(o,i){var s={};"string"==typeof o||o instanceof Array?s.text=o:s=o,this.options=t.extend({},i,s)},process:function(){this.setup(),this.addToDom(),this.position(),this.bindToast(),this.animate()},setup:function(){var o="";if(this._toastEl=this._toastEl||t("<div></div>",{"class":"jq-toast-single"}),o+='<span class="jq-toast-loader"></span>',this.options.allowToastClose&&(o+='<span class="close-jq-toast-single">&times;</span>'),this.options.text instanceof Array){this.options.heading&&(o+='<h2 class="jq-toast-heading">'+this.options.heading+"</h2>"),o+='<ul class="jq-toast-ul">';for(var i=0;i<this.options.text.length;i++)o+='<li class="jq-toast-li" id="jq-toast-item-'+i+'">'+this.options.text[i]+"</li>";o+="</ul>"}else this.options.heading&&(o+='<h2 class="jq-toast-heading">'+this.options.heading+"</h2>"),o+=this.options.text;this._toastEl.html(o),this.options.bgColor!==!1&&this._toastEl.css("background-color",this.options.bgColor),this.options.textColor!==!1&&this._toastEl.css("color",this.options.textColor),this.options.textAlign&&this._toastEl.css("text-align",this.options.textAlign),this.options.icon!==!1&&(this._toastEl.addClass("jq-has-icon"),-1!==t.inArray(this.options.icon,this._defaultIcons)&&this._toastEl.addClass("jq-icon-"+this.options.icon)),this.options["class"]!==!1&&this._toastEl.addClass(this.options["class"])},position:function(){"string"==typeof this.options.position&&-1!==t.inArray(this.options.position,this._positionClasses)?"bottom-center"===this.options.position?this._container.css({left:t(o).outerWidth()/2-this._container.outerWidth()/2,bottom:20}):"top-center"===this.options.position?this._container.css({left:t(o).outerWidth()/2-this._container.outerWidth()/2,top:20}):"mid-center"===this.options.position?this._container.css({left:t(o).outerWidth()/2-this._container.outerWidth()/2,top:t(o).outerHeight()/2-this._container.outerHeight()/2}):this._container.addClass(this.options.position):"object"==typeof this.options.position?this._container.css({top:this.options.position.top?this.options.position.top:"auto",bottom:this.options.position.bottom?this.options.position.bottom:"auto",left:this.options.position.left?this.options.position.left:"auto",right:this.options.position.right?this.options.position.right:"auto"}):this._container.addClass("bottom-left")},bindToast:function(){var t=this;this._toastEl.on("afterShown",function(){t.processLoader()}),this._toastEl.find(".close-jq-toast-single").on("click",function(o){o.preventDefault(),"fade"===t.options.showHideTransition?(t._toastEl.trigger("beforeHide"),t._toastEl.fadeOut(function(){t._toastEl.trigger("afterHidden")})):"slide"===t.options.showHideTransition?(t._toastEl.trigger("beforeHide"),t._toastEl.slideUp(function(){t._toastEl.trigger("afterHidden")})):(t._toastEl.trigger("beforeHide"),t._toastEl.hide(function(){t._toastEl.trigger("afterHidden")}))}),"function"==typeof this.options.beforeShow&&this._toastEl.on("beforeShow",function(){t.options.beforeShow()}),"function"==typeof this.options.afterShown&&this._toastEl.on("afterShown",function(){t.options.afterShown()}),"function"==typeof this.options.beforeHide&&this._toastEl.on("beforeHide",function(){t.options.beforeHide()}),"function"==typeof this.options.afterHidden&&this._toastEl.on("afterHidden",function(){t.options.afterHidden()})},addToDom:function(){var o=t(".jq-toast-wrap");if(0===o.length?(o=t("<div></div>",{"class":"jq-toast-wrap"}),t("body").append(o)):(!this.options.stack||isNaN(parseInt(this.options.stack,10)))&&o.empty(),o.find(".jq-toast-single:hidden").remove(),o.append(this._toastEl),this.options.stack&&!isNaN(parseInt(this.options.stack),10)){var i=o.find(".jq-toast-single").length,s=i-this.options.stack;s>0&&t(".jq-toast-wrap").find(".jq-toast-single").slice(0,s).remove()}this._container=o},canAutoHide:function(){return this.options.hideAfter!==!1&&!isNaN(parseInt(this.options.hideAfter,10))},processLoader:function(){if(!this.canAutoHide()||this.options.loader===!1)return!1;var t=this._toastEl.find(".jq-toast-loader"),o=(this.options.hideAfter-400)/1e3+"s",i=this.options.loaderBg,s=t.attr("style")||"";s=s.substring(0,s.indexOf("-webkit-transition")),s+="-webkit-transition: width "+o+" ease-in;                       -o-transition: width "+o+" ease-in;                       transition: width "+o+" ease-in;                       background-color: "+i+";",t.attr("style",s).addClass("jq-toast-loaded")},animate:function(){var t=this;if(this._toastEl.hide(),this._toastEl.trigger("beforeShow"),"fade"===this.options.showHideTransition.toLowerCase()?this._toastEl.fadeIn(function(){t._toastEl.trigger("afterShown")}):"slide"===this.options.showHideTransition.toLowerCase()?this._toastEl.slideDown(function(){t._toastEl.trigger("afterShown")}):this._toastEl.show(function(){t._toastEl.trigger("afterShown")}),this.canAutoHide()){var t=this;o.setTimeout(function(){"fade"===t.options.showHideTransition.toLowerCase()?(t._toastEl.trigger("beforeHide"),t._toastEl.fadeOut(function(){t._toastEl.trigger("afterHidden")})):"slide"===t.options.showHideTransition.toLowerCase()?(t._toastEl.trigger("beforeHide"),t._toastEl.slideUp(function(){t._toastEl.trigger("afterHidden")})):(t._toastEl.trigger("beforeHide"),t._toastEl.hide(function(){t._toastEl.trigger("afterHidden")}))},this.options.hideAfter)}},reset:function(o){"all"===o?t(".jq-toast-wrap").remove():this._toastEl.remove()},update:function(t){this.prepareOptions(t,this.options),this.setup(),this.bindToast()}};t.toast=function(t){var o=Object.create(n);return o.init(t,this),{reset:function(t){o.reset(t)},update:function(t){o.update(t)}}},t.toast.options={text:"",heading:"",showHideTransition:"fade",allowToastClose:!0,hideAfter:3e3,loader:!0,loaderBg:"#9EC600",stack:5,position:"bottom-left",bgColor:!1,textColor:!1,textAlign:"left",icon:!1,beforeShow:function(){},afterShown:function(){},beforeHide:function(){},afterHidden:function(){}}}(jQuery,window,document);
// init the status tabs click event
$('a[data-bs-toggle="tab"]').on('click', function (e) {
    loadData();
});

// init the required variables
let clients = [];

// load the initial data
loadData();

function loadData() {
    $.ajax({
        url: '/ravenSMS/clients/index/?handler=clients',
        data: {
            pageIndex: 1,
            pageSize: 5,
            searchQuery: $("#search-query").val(),
            Status: $('nav#clients-status a.active').attr('value'),
            phoneNumbers: [],
        },
        success: function (result) {
            // save the result
            clients = result.data;

            // select table element
            const $table = $("#clients_table");

            // empty the table
            $("#clients_table > tbody").empty();

            // add the data to the table
            $.each(clients, function () {
                $table.append(buildTableRow(this));
            });

            // set the pagination details
            SetPagination(
                result.pagination.rowsCount,
                result.pagination.pageIndex,
                result.pagination.pageSize,
            );
        }
    });
}

function buildTableRow(client) {
    let markup = `<tr>
        <td style="max-width:150px" class="cell">${client.id}</td>
        <td class="cell"><span class="truncate">${client.name}</span></td>
        <td class="cell">${GetStatusSpan(client.status)}</td>
        <td class="cell fit">`;

    // add the preview page if the client has been configured
    if (client.status != 3) {
        markup += `<a class="btn-sm app-btn-secondary" href="Clients/Preview/${client.id}">View</a>`;
    }

    // add the setup page id the client is not configured
    if (client.status == 3) {
        markup += `<a class="btn-sm app-btn-secondary ms-2" href="Clients/Setup/${client.id}">Setup</a>`;
    }

    // add delete button
    markup += `<button class="btn-sm app-btn-secondary ms-2" onClick="deleteClient('${client.id}')">Delete</button></td></tr>`;

    return markup;
}

function SetPagination(rowsCount, pageIndex, pageSize) {
    // select the paginator
    const $paginator = $("#paginator");

    // empty the paginator
    $paginator.empty();

    // append the previous button
    $paginator.append(`
            <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
            </li>
        `);

    // get the pagination logic
    const pagination = paginate(rowsCount, pageIndex, pageSize);

    // append pages
    $.each(pagination.pages, function () {
        $paginator.append(`<li class="page-item ${this == pagination.currentPage ? 'active' : ''}"><a class="page-link" href="#">${this}</a></li>`);
    })

    // append the Next button
    $paginator.append(`
            <li class="page-item">
                <a class="page-link" href="#">Next</a>
            </li>
        `);
}

function GetStatusSpan(status) {
    switch (status) {
        case 0: return `<span class="badge bg-warning">UnActive</span>`
        case 1: return `<span class="badge bg-success">Connected</span>`
        case 2: return `<span class="badge bg-danger">Disconnected</span>`
        default: return `<span class="badge bg-danger">Require setup</span>`
    }
}

function deleteClient(clientId) {
    $.get('/ravenSMS/clients/index/?handler=RemoveClient&clientId=' + clientId)
        .done(function (result) {
            if (result.isSuccess) {
                $.toast({
                    heading: 'Success',
                    text: 'client has been deleted successfully.',
                    showHideTransition: 'slide',
                    position: 'top-right',
                    icon: 'success'
                });

                loadData();
                return;
            }

            $.toast({
                heading: 'Failed to resend',
                text: '<p>failed to delete the client, error message:<br/>' + result.error + '</p>',
                showHideTransition: 'fade',
                position: 'top-right',
                icon: 'error'
            });
        });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS50b2FzdC5taW4uanMiLCJpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImNsaWVudHMuaW5kZXgucGFnZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcImZ1bmN0aW9uXCIhPXR5cGVvZiBPYmplY3QuY3JlYXRlJiYoT2JqZWN0LmNyZWF0ZT1mdW5jdGlvbih0KXtmdW5jdGlvbiBvKCl7fXJldHVybiBvLnByb3RvdHlwZT10LG5ldyBvfSksZnVuY3Rpb24odCxvLGkscyl7XCJ1c2Ugc3RyaWN0XCI7dmFyIG49e19wb3NpdGlvbkNsYXNzZXM6W1wiYm90dG9tLWxlZnRcIixcImJvdHRvbS1yaWdodFwiLFwidG9wLXJpZ2h0XCIsXCJ0b3AtbGVmdFwiLFwiYm90dG9tLWNlbnRlclwiLFwidG9wLWNlbnRlclwiLFwibWlkLWNlbnRlclwiXSxfZGVmYXVsdEljb25zOltcInN1Y2Nlc3NcIixcImVycm9yXCIsXCJpbmZvXCIsXCJ3YXJuaW5nXCJdLGluaXQ6ZnVuY3Rpb24obyxpKXt0aGlzLnByZXBhcmVPcHRpb25zKG8sdC50b2FzdC5vcHRpb25zKSx0aGlzLnByb2Nlc3MoKX0scHJlcGFyZU9wdGlvbnM6ZnVuY3Rpb24obyxpKXt2YXIgcz17fTtcInN0cmluZ1wiPT10eXBlb2Ygb3x8byBpbnN0YW5jZW9mIEFycmF5P3MudGV4dD1vOnM9byx0aGlzLm9wdGlvbnM9dC5leHRlbmQoe30saSxzKX0scHJvY2VzczpmdW5jdGlvbigpe3RoaXMuc2V0dXAoKSx0aGlzLmFkZFRvRG9tKCksdGhpcy5wb3NpdGlvbigpLHRoaXMuYmluZFRvYXN0KCksdGhpcy5hbmltYXRlKCl9LHNldHVwOmZ1bmN0aW9uKCl7dmFyIG89XCJcIjtpZih0aGlzLl90b2FzdEVsPXRoaXMuX3RvYXN0RWx8fHQoXCI8ZGl2PjwvZGl2PlwiLHtcImNsYXNzXCI6XCJqcS10b2FzdC1zaW5nbGVcIn0pLG8rPSc8c3BhbiBjbGFzcz1cImpxLXRvYXN0LWxvYWRlclwiPjwvc3Bhbj4nLHRoaXMub3B0aW9ucy5hbGxvd1RvYXN0Q2xvc2UmJihvKz0nPHNwYW4gY2xhc3M9XCJjbG9zZS1qcS10b2FzdC1zaW5nbGVcIj4mdGltZXM7PC9zcGFuPicpLHRoaXMub3B0aW9ucy50ZXh0IGluc3RhbmNlb2YgQXJyYXkpe3RoaXMub3B0aW9ucy5oZWFkaW5nJiYobys9JzxoMiBjbGFzcz1cImpxLXRvYXN0LWhlYWRpbmdcIj4nK3RoaXMub3B0aW9ucy5oZWFkaW5nK1wiPC9oMj5cIiksbys9Jzx1bCBjbGFzcz1cImpxLXRvYXN0LXVsXCI+Jztmb3IodmFyIGk9MDtpPHRoaXMub3B0aW9ucy50ZXh0Lmxlbmd0aDtpKyspbys9JzxsaSBjbGFzcz1cImpxLXRvYXN0LWxpXCIgaWQ9XCJqcS10b2FzdC1pdGVtLScraSsnXCI+Jyt0aGlzLm9wdGlvbnMudGV4dFtpXStcIjwvbGk+XCI7bys9XCI8L3VsPlwifWVsc2UgdGhpcy5vcHRpb25zLmhlYWRpbmcmJihvKz0nPGgyIGNsYXNzPVwianEtdG9hc3QtaGVhZGluZ1wiPicrdGhpcy5vcHRpb25zLmhlYWRpbmcrXCI8L2gyPlwiKSxvKz10aGlzLm9wdGlvbnMudGV4dDt0aGlzLl90b2FzdEVsLmh0bWwobyksdGhpcy5vcHRpb25zLmJnQ29sb3IhPT0hMSYmdGhpcy5fdG9hc3RFbC5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsdGhpcy5vcHRpb25zLmJnQ29sb3IpLHRoaXMub3B0aW9ucy50ZXh0Q29sb3IhPT0hMSYmdGhpcy5fdG9hc3RFbC5jc3MoXCJjb2xvclwiLHRoaXMub3B0aW9ucy50ZXh0Q29sb3IpLHRoaXMub3B0aW9ucy50ZXh0QWxpZ24mJnRoaXMuX3RvYXN0RWwuY3NzKFwidGV4dC1hbGlnblwiLHRoaXMub3B0aW9ucy50ZXh0QWxpZ24pLHRoaXMub3B0aW9ucy5pY29uIT09ITEmJih0aGlzLl90b2FzdEVsLmFkZENsYXNzKFwianEtaGFzLWljb25cIiksLTEhPT10LmluQXJyYXkodGhpcy5vcHRpb25zLmljb24sdGhpcy5fZGVmYXVsdEljb25zKSYmdGhpcy5fdG9hc3RFbC5hZGRDbGFzcyhcImpxLWljb24tXCIrdGhpcy5vcHRpb25zLmljb24pKSx0aGlzLm9wdGlvbnNbXCJjbGFzc1wiXSE9PSExJiZ0aGlzLl90b2FzdEVsLmFkZENsYXNzKHRoaXMub3B0aW9uc1tcImNsYXNzXCJdKX0scG9zaXRpb246ZnVuY3Rpb24oKXtcInN0cmluZ1wiPT10eXBlb2YgdGhpcy5vcHRpb25zLnBvc2l0aW9uJiYtMSE9PXQuaW5BcnJheSh0aGlzLm9wdGlvbnMucG9zaXRpb24sdGhpcy5fcG9zaXRpb25DbGFzc2VzKT9cImJvdHRvbS1jZW50ZXJcIj09PXRoaXMub3B0aW9ucy5wb3NpdGlvbj90aGlzLl9jb250YWluZXIuY3NzKHtsZWZ0OnQobykub3V0ZXJXaWR0aCgpLzItdGhpcy5fY29udGFpbmVyLm91dGVyV2lkdGgoKS8yLGJvdHRvbToyMH0pOlwidG9wLWNlbnRlclwiPT09dGhpcy5vcHRpb25zLnBvc2l0aW9uP3RoaXMuX2NvbnRhaW5lci5jc3Moe2xlZnQ6dChvKS5vdXRlcldpZHRoKCkvMi10aGlzLl9jb250YWluZXIub3V0ZXJXaWR0aCgpLzIsdG9wOjIwfSk6XCJtaWQtY2VudGVyXCI9PT10aGlzLm9wdGlvbnMucG9zaXRpb24/dGhpcy5fY29udGFpbmVyLmNzcyh7bGVmdDp0KG8pLm91dGVyV2lkdGgoKS8yLXRoaXMuX2NvbnRhaW5lci5vdXRlcldpZHRoKCkvMix0b3A6dChvKS5vdXRlckhlaWdodCgpLzItdGhpcy5fY29udGFpbmVyLm91dGVySGVpZ2h0KCkvMn0pOnRoaXMuX2NvbnRhaW5lci5hZGRDbGFzcyh0aGlzLm9wdGlvbnMucG9zaXRpb24pOlwib2JqZWN0XCI9PXR5cGVvZiB0aGlzLm9wdGlvbnMucG9zaXRpb24/dGhpcy5fY29udGFpbmVyLmNzcyh7dG9wOnRoaXMub3B0aW9ucy5wb3NpdGlvbi50b3A/dGhpcy5vcHRpb25zLnBvc2l0aW9uLnRvcDpcImF1dG9cIixib3R0b206dGhpcy5vcHRpb25zLnBvc2l0aW9uLmJvdHRvbT90aGlzLm9wdGlvbnMucG9zaXRpb24uYm90dG9tOlwiYXV0b1wiLGxlZnQ6dGhpcy5vcHRpb25zLnBvc2l0aW9uLmxlZnQ/dGhpcy5vcHRpb25zLnBvc2l0aW9uLmxlZnQ6XCJhdXRvXCIscmlnaHQ6dGhpcy5vcHRpb25zLnBvc2l0aW9uLnJpZ2h0P3RoaXMub3B0aW9ucy5wb3NpdGlvbi5yaWdodDpcImF1dG9cIn0pOnRoaXMuX2NvbnRhaW5lci5hZGRDbGFzcyhcImJvdHRvbS1sZWZ0XCIpfSxiaW5kVG9hc3Q6ZnVuY3Rpb24oKXt2YXIgdD10aGlzO3RoaXMuX3RvYXN0RWwub24oXCJhZnRlclNob3duXCIsZnVuY3Rpb24oKXt0LnByb2Nlc3NMb2FkZXIoKX0pLHRoaXMuX3RvYXN0RWwuZmluZChcIi5jbG9zZS1qcS10b2FzdC1zaW5nbGVcIikub24oXCJjbGlja1wiLGZ1bmN0aW9uKG8pe28ucHJldmVudERlZmF1bHQoKSxcImZhZGVcIj09PXQub3B0aW9ucy5zaG93SGlkZVRyYW5zaXRpb24/KHQuX3RvYXN0RWwudHJpZ2dlcihcImJlZm9yZUhpZGVcIiksdC5fdG9hc3RFbC5mYWRlT3V0KGZ1bmN0aW9uKCl7dC5fdG9hc3RFbC50cmlnZ2VyKFwiYWZ0ZXJIaWRkZW5cIil9KSk6XCJzbGlkZVwiPT09dC5vcHRpb25zLnNob3dIaWRlVHJhbnNpdGlvbj8odC5fdG9hc3RFbC50cmlnZ2VyKFwiYmVmb3JlSGlkZVwiKSx0Ll90b2FzdEVsLnNsaWRlVXAoZnVuY3Rpb24oKXt0Ll90b2FzdEVsLnRyaWdnZXIoXCJhZnRlckhpZGRlblwiKX0pKToodC5fdG9hc3RFbC50cmlnZ2VyKFwiYmVmb3JlSGlkZVwiKSx0Ll90b2FzdEVsLmhpZGUoZnVuY3Rpb24oKXt0Ll90b2FzdEVsLnRyaWdnZXIoXCJhZnRlckhpZGRlblwiKX0pKX0pLFwiZnVuY3Rpb25cIj09dHlwZW9mIHRoaXMub3B0aW9ucy5iZWZvcmVTaG93JiZ0aGlzLl90b2FzdEVsLm9uKFwiYmVmb3JlU2hvd1wiLGZ1bmN0aW9uKCl7dC5vcHRpb25zLmJlZm9yZVNob3coKX0pLFwiZnVuY3Rpb25cIj09dHlwZW9mIHRoaXMub3B0aW9ucy5hZnRlclNob3duJiZ0aGlzLl90b2FzdEVsLm9uKFwiYWZ0ZXJTaG93blwiLGZ1bmN0aW9uKCl7dC5vcHRpb25zLmFmdGVyU2hvd24oKX0pLFwiZnVuY3Rpb25cIj09dHlwZW9mIHRoaXMub3B0aW9ucy5iZWZvcmVIaWRlJiZ0aGlzLl90b2FzdEVsLm9uKFwiYmVmb3JlSGlkZVwiLGZ1bmN0aW9uKCl7dC5vcHRpb25zLmJlZm9yZUhpZGUoKX0pLFwiZnVuY3Rpb25cIj09dHlwZW9mIHRoaXMub3B0aW9ucy5hZnRlckhpZGRlbiYmdGhpcy5fdG9hc3RFbC5vbihcImFmdGVySGlkZGVuXCIsZnVuY3Rpb24oKXt0Lm9wdGlvbnMuYWZ0ZXJIaWRkZW4oKX0pfSxhZGRUb0RvbTpmdW5jdGlvbigpe3ZhciBvPXQoXCIuanEtdG9hc3Qtd3JhcFwiKTtpZigwPT09by5sZW5ndGg/KG89dChcIjxkaXY+PC9kaXY+XCIse1wiY2xhc3NcIjpcImpxLXRvYXN0LXdyYXBcIn0pLHQoXCJib2R5XCIpLmFwcGVuZChvKSk6KCF0aGlzLm9wdGlvbnMuc3RhY2t8fGlzTmFOKHBhcnNlSW50KHRoaXMub3B0aW9ucy5zdGFjaywxMCkpKSYmby5lbXB0eSgpLG8uZmluZChcIi5qcS10b2FzdC1zaW5nbGU6aGlkZGVuXCIpLnJlbW92ZSgpLG8uYXBwZW5kKHRoaXMuX3RvYXN0RWwpLHRoaXMub3B0aW9ucy5zdGFjayYmIWlzTmFOKHBhcnNlSW50KHRoaXMub3B0aW9ucy5zdGFjayksMTApKXt2YXIgaT1vLmZpbmQoXCIuanEtdG9hc3Qtc2luZ2xlXCIpLmxlbmd0aCxzPWktdGhpcy5vcHRpb25zLnN0YWNrO3M+MCYmdChcIi5qcS10b2FzdC13cmFwXCIpLmZpbmQoXCIuanEtdG9hc3Qtc2luZ2xlXCIpLnNsaWNlKDAscykucmVtb3ZlKCl9dGhpcy5fY29udGFpbmVyPW99LGNhbkF1dG9IaWRlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5oaWRlQWZ0ZXIhPT0hMSYmIWlzTmFOKHBhcnNlSW50KHRoaXMub3B0aW9ucy5oaWRlQWZ0ZXIsMTApKX0scHJvY2Vzc0xvYWRlcjpmdW5jdGlvbigpe2lmKCF0aGlzLmNhbkF1dG9IaWRlKCl8fHRoaXMub3B0aW9ucy5sb2FkZXI9PT0hMSlyZXR1cm4hMTt2YXIgdD10aGlzLl90b2FzdEVsLmZpbmQoXCIuanEtdG9hc3QtbG9hZGVyXCIpLG89KHRoaXMub3B0aW9ucy5oaWRlQWZ0ZXItNDAwKS8xZTMrXCJzXCIsaT10aGlzLm9wdGlvbnMubG9hZGVyQmcscz10LmF0dHIoXCJzdHlsZVwiKXx8XCJcIjtzPXMuc3Vic3RyaW5nKDAscy5pbmRleE9mKFwiLXdlYmtpdC10cmFuc2l0aW9uXCIpKSxzKz1cIi13ZWJraXQtdHJhbnNpdGlvbjogd2lkdGggXCIrbytcIiBlYXNlLWluOyAgICAgICAgICAgICAgICAgICAgICAgLW8tdHJhbnNpdGlvbjogd2lkdGggXCIrbytcIiBlYXNlLWluOyAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogd2lkdGggXCIrbytcIiBlYXNlLWluOyAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogXCIraStcIjtcIix0LmF0dHIoXCJzdHlsZVwiLHMpLmFkZENsYXNzKFwianEtdG9hc3QtbG9hZGVkXCIpfSxhbmltYXRlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcztpZih0aGlzLl90b2FzdEVsLmhpZGUoKSx0aGlzLl90b2FzdEVsLnRyaWdnZXIoXCJiZWZvcmVTaG93XCIpLFwiZmFkZVwiPT09dGhpcy5vcHRpb25zLnNob3dIaWRlVHJhbnNpdGlvbi50b0xvd2VyQ2FzZSgpP3RoaXMuX3RvYXN0RWwuZmFkZUluKGZ1bmN0aW9uKCl7dC5fdG9hc3RFbC50cmlnZ2VyKFwiYWZ0ZXJTaG93blwiKX0pOlwic2xpZGVcIj09PXRoaXMub3B0aW9ucy5zaG93SGlkZVRyYW5zaXRpb24udG9Mb3dlckNhc2UoKT90aGlzLl90b2FzdEVsLnNsaWRlRG93bihmdW5jdGlvbigpe3QuX3RvYXN0RWwudHJpZ2dlcihcImFmdGVyU2hvd25cIil9KTp0aGlzLl90b2FzdEVsLnNob3coZnVuY3Rpb24oKXt0Ll90b2FzdEVsLnRyaWdnZXIoXCJhZnRlclNob3duXCIpfSksdGhpcy5jYW5BdXRvSGlkZSgpKXt2YXIgdD10aGlzO28uc2V0VGltZW91dChmdW5jdGlvbigpe1wiZmFkZVwiPT09dC5vcHRpb25zLnNob3dIaWRlVHJhbnNpdGlvbi50b0xvd2VyQ2FzZSgpPyh0Ll90b2FzdEVsLnRyaWdnZXIoXCJiZWZvcmVIaWRlXCIpLHQuX3RvYXN0RWwuZmFkZU91dChmdW5jdGlvbigpe3QuX3RvYXN0RWwudHJpZ2dlcihcImFmdGVySGlkZGVuXCIpfSkpOlwic2xpZGVcIj09PXQub3B0aW9ucy5zaG93SGlkZVRyYW5zaXRpb24udG9Mb3dlckNhc2UoKT8odC5fdG9hc3RFbC50cmlnZ2VyKFwiYmVmb3JlSGlkZVwiKSx0Ll90b2FzdEVsLnNsaWRlVXAoZnVuY3Rpb24oKXt0Ll90b2FzdEVsLnRyaWdnZXIoXCJhZnRlckhpZGRlblwiKX0pKToodC5fdG9hc3RFbC50cmlnZ2VyKFwiYmVmb3JlSGlkZVwiKSx0Ll90b2FzdEVsLmhpZGUoZnVuY3Rpb24oKXt0Ll90b2FzdEVsLnRyaWdnZXIoXCJhZnRlckhpZGRlblwiKX0pKX0sdGhpcy5vcHRpb25zLmhpZGVBZnRlcil9fSxyZXNldDpmdW5jdGlvbihvKXtcImFsbFwiPT09bz90KFwiLmpxLXRvYXN0LXdyYXBcIikucmVtb3ZlKCk6dGhpcy5fdG9hc3RFbC5yZW1vdmUoKX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3RoaXMucHJlcGFyZU9wdGlvbnModCx0aGlzLm9wdGlvbnMpLHRoaXMuc2V0dXAoKSx0aGlzLmJpbmRUb2FzdCgpfX07dC50b2FzdD1mdW5jdGlvbih0KXt2YXIgbz1PYmplY3QuY3JlYXRlKG4pO3JldHVybiBvLmluaXQodCx0aGlzKSx7cmVzZXQ6ZnVuY3Rpb24odCl7by5yZXNldCh0KX0sdXBkYXRlOmZ1bmN0aW9uKHQpe28udXBkYXRlKHQpfX19LHQudG9hc3Qub3B0aW9ucz17dGV4dDpcIlwiLGhlYWRpbmc6XCJcIixzaG93SGlkZVRyYW5zaXRpb246XCJmYWRlXCIsYWxsb3dUb2FzdENsb3NlOiEwLGhpZGVBZnRlcjozZTMsbG9hZGVyOiEwLGxvYWRlckJnOlwiIzlFQzYwMFwiLHN0YWNrOjUscG9zaXRpb246XCJib3R0b20tbGVmdFwiLGJnQ29sb3I6ITEsdGV4dENvbG9yOiExLHRleHRBbGlnbjpcImxlZnRcIixpY29uOiExLGJlZm9yZVNob3c6ZnVuY3Rpb24oKXt9LGFmdGVyU2hvd246ZnVuY3Rpb24oKXt9LGJlZm9yZUhpZGU6ZnVuY3Rpb24oKXt9LGFmdGVySGlkZGVuOmZ1bmN0aW9uKCl7fX19KGpRdWVyeSx3aW5kb3csZG9jdW1lbnQpOyIsIi8vIGluaXQgdGhlIHN0YXR1cyB0YWJzIGNsaWNrIGV2ZW50XHJcbiQoJ2FbZGF0YS1icy10b2dnbGU9XCJ0YWJcIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgbG9hZERhdGEoKTtcclxufSk7XHJcblxyXG4vLyBpbml0IHRoZSByZXF1aXJlZCB2YXJpYWJsZXNcclxubGV0IGNsaWVudHMgPSBbXTtcclxuXHJcbi8vIGxvYWQgdGhlIGluaXRpYWwgZGF0YVxyXG5sb2FkRGF0YSgpO1xyXG5cclxuZnVuY3Rpb24gbG9hZERhdGEoKSB7XHJcbiAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogJy9yYXZlblNNUy9jbGllbnRzL2luZGV4Lz9oYW5kbGVyPWNsaWVudHMnLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgcGFnZUluZGV4OiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogNSxcclxuICAgICAgICAgICAgc2VhcmNoUXVlcnk6ICQoXCIjc2VhcmNoLXF1ZXJ5XCIpLnZhbCgpLFxyXG4gICAgICAgICAgICBTdGF0dXM6ICQoJ25hdiNjbGllbnRzLXN0YXR1cyBhLmFjdGl2ZScpLmF0dHIoJ3ZhbHVlJyksXHJcbiAgICAgICAgICAgIHBob25lTnVtYmVyczogW10sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgIC8vIHNhdmUgdGhlIHJlc3VsdFxyXG4gICAgICAgICAgICBjbGllbnRzID0gcmVzdWx0LmRhdGE7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgdGFibGUgZWxlbWVudFxyXG4gICAgICAgICAgICBjb25zdCAkdGFibGUgPSAkKFwiI2NsaWVudHNfdGFibGVcIik7XHJcblxyXG4gICAgICAgICAgICAvLyBlbXB0eSB0aGUgdGFibGVcclxuICAgICAgICAgICAgJChcIiNjbGllbnRzX3RhYmxlID4gdGJvZHlcIikuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGFkZCB0aGUgZGF0YSB0byB0aGUgdGFibGVcclxuICAgICAgICAgICAgJC5lYWNoKGNsaWVudHMsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICR0YWJsZS5hcHBlbmQoYnVpbGRUYWJsZVJvdyh0aGlzKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gc2V0IHRoZSBwYWdpbmF0aW9uIGRldGFpbHNcclxuICAgICAgICAgICAgU2V0UGFnaW5hdGlvbihcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wYWdpbmF0aW9uLnJvd3NDb3VudCxcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wYWdpbmF0aW9uLnBhZ2VJbmRleCxcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wYWdpbmF0aW9uLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBidWlsZFRhYmxlUm93KGNsaWVudCkge1xyXG4gICAgbGV0IG1hcmt1cCA9IGA8dHI+XHJcbiAgICAgICAgPHRkIHN0eWxlPVwibWF4LXdpZHRoOjE1MHB4XCIgY2xhc3M9XCJjZWxsXCI+JHtjbGllbnQuaWR9PC90ZD5cclxuICAgICAgICA8dGQgY2xhc3M9XCJjZWxsXCI+PHNwYW4gY2xhc3M9XCJ0cnVuY2F0ZVwiPiR7Y2xpZW50Lm5hbWV9PC9zcGFuPjwvdGQ+XHJcbiAgICAgICAgPHRkIGNsYXNzPVwiY2VsbFwiPiR7R2V0U3RhdHVzU3BhbihjbGllbnQuc3RhdHVzKX08L3RkPlxyXG4gICAgICAgIDx0ZCBjbGFzcz1cImNlbGwgZml0XCI+YDtcclxuXHJcbiAgICAvLyBhZGQgdGhlIHByZXZpZXcgcGFnZSBpZiB0aGUgY2xpZW50IGhhcyBiZWVuIGNvbmZpZ3VyZWRcclxuICAgIGlmIChjbGllbnQuc3RhdHVzICE9IDMpIHtcclxuICAgICAgICBtYXJrdXAgKz0gYDxhIGNsYXNzPVwiYnRuLXNtIGFwcC1idG4tc2Vjb25kYXJ5XCIgaHJlZj1cIkNsaWVudHMvUHJldmlldy8ke2NsaWVudC5pZH1cIj5WaWV3PC9hPmA7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWRkIHRoZSBzZXR1cCBwYWdlIGlkIHRoZSBjbGllbnQgaXMgbm90IGNvbmZpZ3VyZWRcclxuICAgIGlmIChjbGllbnQuc3RhdHVzID09IDMpIHtcclxuICAgICAgICBtYXJrdXAgKz0gYDxhIGNsYXNzPVwiYnRuLXNtIGFwcC1idG4tc2Vjb25kYXJ5IG1zLTJcIiBocmVmPVwiQ2xpZW50cy9TZXR1cC8ke2NsaWVudC5pZH1cIj5TZXR1cDwvYT5gO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFkZCBkZWxldGUgYnV0dG9uXHJcbiAgICBtYXJrdXAgKz0gYDxidXR0b24gY2xhc3M9XCJidG4tc20gYXBwLWJ0bi1zZWNvbmRhcnkgbXMtMlwiIG9uQ2xpY2s9XCJkZWxldGVDbGllbnQoJyR7Y2xpZW50LmlkfScpXCI+RGVsZXRlPC9idXR0b24+PC90ZD48L3RyPmA7XHJcblxyXG4gICAgcmV0dXJuIG1hcmt1cDtcclxufVxyXG5cclxuZnVuY3Rpb24gU2V0UGFnaW5hdGlvbihyb3dzQ291bnQsIHBhZ2VJbmRleCwgcGFnZVNpemUpIHtcclxuICAgIC8vIHNlbGVjdCB0aGUgcGFnaW5hdG9yXHJcbiAgICBjb25zdCAkcGFnaW5hdG9yID0gJChcIiNwYWdpbmF0b3JcIik7XHJcblxyXG4gICAgLy8gZW1wdHkgdGhlIHBhZ2luYXRvclxyXG4gICAgJHBhZ2luYXRvci5lbXB0eSgpO1xyXG5cclxuICAgIC8vIGFwcGVuZCB0aGUgcHJldmlvdXMgYnV0dG9uXHJcbiAgICAkcGFnaW5hdG9yLmFwcGVuZChgXHJcbiAgICAgICAgICAgIDxsaSBjbGFzcz1cInBhZ2UtaXRlbSBkaXNhYmxlZFwiPlxyXG4gICAgICAgICAgICAgICAgPGEgY2xhc3M9XCJwYWdlLWxpbmtcIiBocmVmPVwiI1wiIHRhYmluZGV4PVwiLTFcIiBhcmlhLWRpc2FibGVkPVwidHJ1ZVwiPlByZXZpb3VzPC9hPlxyXG4gICAgICAgICAgICA8L2xpPlxyXG4gICAgICAgIGApO1xyXG5cclxuICAgIC8vIGdldCB0aGUgcGFnaW5hdGlvbiBsb2dpY1xyXG4gICAgY29uc3QgcGFnaW5hdGlvbiA9IHBhZ2luYXRlKHJvd3NDb3VudCwgcGFnZUluZGV4LCBwYWdlU2l6ZSk7XHJcblxyXG4gICAgLy8gYXBwZW5kIHBhZ2VzXHJcbiAgICAkLmVhY2gocGFnaW5hdGlvbi5wYWdlcywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRwYWdpbmF0b3IuYXBwZW5kKGA8bGkgY2xhc3M9XCJwYWdlLWl0ZW0gJHt0aGlzID09IHBhZ2luYXRpb24uY3VycmVudFBhZ2UgPyAnYWN0aXZlJyA6ICcnfVwiPjxhIGNsYXNzPVwicGFnZS1saW5rXCIgaHJlZj1cIiNcIj4ke3RoaXN9PC9hPjwvbGk+YCk7XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIGFwcGVuZCB0aGUgTmV4dCBidXR0b25cclxuICAgICRwYWdpbmF0b3IuYXBwZW5kKGBcclxuICAgICAgICAgICAgPGxpIGNsYXNzPVwicGFnZS1pdGVtXCI+XHJcbiAgICAgICAgICAgICAgICA8YSBjbGFzcz1cInBhZ2UtbGlua1wiIGhyZWY9XCIjXCI+TmV4dDwvYT5cclxuICAgICAgICAgICAgPC9saT5cclxuICAgICAgICBgKTtcclxufVxyXG5cclxuZnVuY3Rpb24gR2V0U3RhdHVzU3BhbihzdGF0dXMpIHtcclxuICAgIHN3aXRjaCAoc3RhdHVzKSB7XHJcbiAgICAgICAgY2FzZSAwOiByZXR1cm4gYDxzcGFuIGNsYXNzPVwiYmFkZ2UgYmctd2FybmluZ1wiPlVuQWN0aXZlPC9zcGFuPmBcclxuICAgICAgICBjYXNlIDE6IHJldHVybiBgPHNwYW4gY2xhc3M9XCJiYWRnZSBiZy1zdWNjZXNzXCI+Q29ubmVjdGVkPC9zcGFuPmBcclxuICAgICAgICBjYXNlIDI6IHJldHVybiBgPHNwYW4gY2xhc3M9XCJiYWRnZSBiZy1kYW5nZXJcIj5EaXNjb25uZWN0ZWQ8L3NwYW4+YFxyXG4gICAgICAgIGRlZmF1bHQ6IHJldHVybiBgPHNwYW4gY2xhc3M9XCJiYWRnZSBiZy1kYW5nZXJcIj5SZXF1aXJlIHNldHVwPC9zcGFuPmBcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZGVsZXRlQ2xpZW50KGNsaWVudElkKSB7XHJcbiAgICAkLmdldCgnL3JhdmVuU01TL2NsaWVudHMvaW5kZXgvP2hhbmRsZXI9UmVtb3ZlQ2xpZW50JmNsaWVudElkPScgKyBjbGllbnRJZClcclxuICAgICAgICAuZG9uZShmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuaXNTdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAkLnRvYXN0KHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkaW5nOiAnU3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ2NsaWVudCBoYXMgYmVlbiBkZWxldGVkIHN1Y2Nlc3NmdWxseS4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJ3NsaWRlJyxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3RvcC1yaWdodCcsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ3N1Y2Nlc3MnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsb2FkRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkLnRvYXN0KHtcclxuICAgICAgICAgICAgICAgIGhlYWRpbmc6ICdGYWlsZWQgdG8gcmVzZW5kJyxcclxuICAgICAgICAgICAgICAgIHRleHQ6ICc8cD5mYWlsZWQgdG8gZGVsZXRlIHRoZSBjbGllbnQsIGVycm9yIG1lc3NhZ2U6PGJyLz4nICsgcmVzdWx0LmVycm9yICsgJzwvcD4nLFxyXG4gICAgICAgICAgICAgICAgc2hvd0hpZGVUcmFuc2l0aW9uOiAnZmFkZScsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3RvcC1yaWdodCcsXHJcbiAgICAgICAgICAgICAgICBpY29uOiAnZXJyb3InXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG59Il19
